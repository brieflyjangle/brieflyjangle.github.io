<!DOCTYPE html>
<html lang="en">

<head>
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		map_reduce | 
	 
	Huiwen Learning Notes
	</title>
	
	<!-- keywords,description -->
	
	

	<!-- favicon -->
	


	<!-- search -->
	<script>
		var searchEngine = "";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.0/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>


	
	

<meta name="generator" content="Hexo 7.3.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="stylesheet" href="/css/prism-dracula.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><header id="header">
    <a id="title" href="/" class="logo">Huiwen Learning Notes</a>

	<ul id="menu">
    

    

    

    
  
    
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="Press Enter to search">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										big_data
									</a>
									
							<ul>
								<li class="file active">
									<a href="/big_data/map-reduce/">
                     
										    map-reduce
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										computer_arch
									</a>
									
							<ul>
								<li class="file">
									<a href="/computer_arch/Chap1-fundamental-quantitative-design-n-analysis/">
                     
										    Chap1-fundamental-quantitative-design-n-analysis
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										data_str_and_algo
									</a>
									
							<ul>
								<li class="file">
									<a href="/data_str_and_algo/Intro-to-data-arch/">
                     
										    Intro-to-data-arch
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/data_str_and_algo/adv-bin-search-tree/">
                     
										    adv-bin-search-tree
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/data_str_and_algo/bin_search_tree/">
                     
										    bin_search_tree
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/data_str_and_algo/intro-to-algo/">
                     
										    intro-to-algo
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/data_str_and_algo/splaytree-search-system-analysis-report/">
                     
										    splaytree-search-system-analysis-report
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										other
									</a>
									
							<ul>
								<li class="file">
									<a href="/other/how-to-start-personal-blog/">
                     
										    how-to-start-personal-blog
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/other/settingUp-shell/">
                     
										    settingUp-shell
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content" class="content">
		<h1 id="article-title">
	map_reduce
</h1>

<!-- meta -->
<div class="article-meta">
	

	<span>HuiWen</span>
	<span>2025-04-20 12:59:39</span>

  <div id="article-categories">
    
		  <span>Categories：</span>
      
    

    
		    <span>Tags：</span>
        
    
  </div>

</div>

<!-- content -->
<div id="article-content">
	<h2 id="Application-Web-Analytic">Application: Web Analytic</h2>
<h3 id="Sample-Data-Input">Sample Data (Input)</h3>
<ol>
<li>Given web server logs, count how many times each URL was accessed.</li>
<li>Each log entry contains: <code>IP_Address</code>, <code>Timestamp</code>, <code>Requested_URL</code>, <code>Referrer_URL</code>, <code>User_Agent</code>.</li>
<li>Example logs:<pre class="language-none"><code class="language-none">192.168.1.1, 2023-10-01T12:01:05, &#x2F;products&#x2F;phone, &#x2F;home, Chrome  
192.168.1.2, 2023-10-01T12:02:10, &#x2F;home, -, Firefox  
192.168.1.1, 2023-10-01T12:03:15, &#x2F;products&#x2F;phone, &#x2F;search, Chrome  
192.168.1.3, 2023-10-01T12:04:20, &#x2F;contact, &#x2F;home, Safari  
192.168.1.2, 2023-10-01T12:05:25, &#x2F;home, -, Firefox  </code></pre>
</li>
</ol>
<h3 id="Part-1-Find-the-number-of-URLs-in-weblogs">Part 1: Find the number of URLs in weblogs</h3>
<h4 id="Map-Phase">Map Phase</h4>
<ol>
<li>Input: Each log line --&gt; Extract <code>Requested_URL</code> --&gt; emit <code>(URL, 1)</code></li>
<li>Mapper output: <pre class="language-none"><code class="language-none">(&#x2F;products&#x2F;phone, 1)  
(&#x2F;home, 1)  
(&#x2F;products&#x2F;phone, 1)  
(&#x2F;contact, 1)  
(&#x2F;home, 1)  </code></pre>
</li>
</ol>
<h4 id="Shuffle-Sort-Phase">Shuffle &amp; Sort Phase</h4>
<ol>
<li>Groups all <code>1</code>s by URL: <pre class="language-none"><code class="language-none">&#x2F;home → [1, 1]  
&#x2F;products&#x2F;phone → [1, 1]  
&#x2F;contact → [1]  </code></pre>
</li>
</ol>
<h4 id="Reduce-Phase">Reduce Phase</h4>
<ol>
<li>Input: <code>(URL, [1, 1, ...])</code> -&gt; sum the counts for each URL.</li>
<li>Reducer Output: <pre class="language-none"><code class="language-none">(&#x2F;home, 2)  
(&#x2F;products&#x2F;phone, 2)  
(&#x2F;contact, 1)  </code></pre>
</li>
</ol>
<h4 id="Final-Result">Final Result</h4>
<pre class="language-none"><code class="language-none">&#x2F;home → 2 visits  
&#x2F;products&#x2F;phone → 2 visits  
&#x2F;contact → 1 visit  </code></pre>
<h3 id="Part-2-Find-where-a-page-links-come-from">Part 2: Find where a page links come from</h3>
<h4 id="Map-Phase-2">Map Phase</h4>
<ol>
<li>Input: Each Log line -&gt; If <code>Referrer_URL</code> is not <code>-</code>, emit <code>(Requested_URL, Refferer_URL)</code>.</li>
<li>Mapper Output: <pre class="language-none"><code class="language-none">(&#x2F;products&#x2F;phone, &#x2F;home)  
(&#x2F;products&#x2F;phone, &#x2F;search)  
(&#x2F;contact, &#x2F;home)  </code></pre>
</li>
</ol>
<h4 id="Shuffle-Sort-Phase-2">Shuffle &amp; Sort Phase</h4>
<ol>
<li>Groups referrers by the requested URL: <pre class="language-none"><code class="language-none">&#x2F;products&#x2F;phone → [&#x2F;home, &#x2F;search]  
&#x2F;contact → [&#x2F;home]  </code></pre>
</li>
</ol>
<h4 id="Reduce-Phase-2">Reduce Phase</h4>
<ol>
<li>Input: <code>(Requested_URL, [Referrer_URL1, Referrer_URL2, ...])</code> -&gt; Aggrege all referring sources for each URL.</li>
<li>Reducer Output: <pre class="language-none"><code class="language-none">(&#x2F;products&#x2F;phone, [&#x2F;home, &#x2F;search])  
(&#x2F;contact, [&#x2F;home])  </code></pre>
</li>
</ol>
<h4 id="Final-Result-2">Final Result</h4>
<pre class="language-none"><code class="language-none">&#x2F;products&#x2F;phone → Traffic comes from: &#x2F;home, &#x2F;search  
&#x2F;contact → Traffic comes from: &#x2F;home  </code></pre>
<hr>
<h2 id="Application-e-commerce">Application : e-commerce</h2>
<h3 id="Samples-Data-Orders-Table">Samples Data ( Orders Table)</h3>
<ol>
<li>Each record represents an order: <pre class="language-none"><code class="language-none">order_id, customer_id, item_id, quantity, price, order_date, company_id  </code></pre>
</li>
<li>Example Data: <pre class="language-none"><code class="language-none">1001, 201, 501, 2, 299.99, 2023-10-01, 1  
1002, 202, 502, 1, 99.99, 2023-10-01, 2  
1003, 203, 501, 3, 299.99, 2023-10-02, 1  
1004, 204, 503, 1, 149.99, 2023-10-02, 3  
1005, 205, 502, 2, 99.99, 2023-10-03, 2  </code></pre>
</li>
</ol>
<h3 id="Part-1-Find-the-number-of-orders-on-certain-items">Part 1: Find the number of orders on certain items</h3>
<h4 id="Map-Phase-3">Map Phase</h4>
<ol>
<li>Input: Each order record -&gt; Extract <code>item_id</code> and emit <code>(item_id, quantity)</code>.</li>
<li>Mapper Output: <pre class="language-none"><code class="language-none">(501, 2)  
(502, 1)  
(501, 3)  
(503, 1)  
(502, 2)  </code></pre>
</li>
</ol>
<h4 id="Shuffle-Sort-Phase-3">Shuffle &amp; Sort Phase</h4>
<ol>
<li>Groups quantites by <code>item_id</code>: <pre class="language-none"><code class="language-none">501 → [2, 3]  
502 → [1, 2]  
503 → [1]  </code></pre>
</li>
</ol>
<h4 id="Reduce-Phase-3">Reduce Phase</h4>
<ol>
<li>Input: <code>(item_id, [quantities])</code> -&gt; Sum quantities for each item.</li>
<li>Reducer Output:</li>
</ol>
<pre class="language-none"><code class="language-none">(501, 5)   &#x2F;&#x2F; 2 + 3 &#x3D; 5 orders  
(502, 3)   &#x2F;&#x2F; 1 + 2 &#x3D; 3 orders  
(503, 1)   &#x2F;&#x2F; Only 1 order  </code></pre>
<h4 id="Final-Result-3">Final Result</h4>
<pre class="language-none"><code class="language-none">Item 501: 5 orders  
Item 502: 3 orders  
Item 503: 1 order  </code></pre>
<h3 id="Part-2-Find-the-average-daily-gain-of-each-company-from-the-start-date-to-the-end-date">Part 2: Find the average daily gain of each company from the start date to the end date</h3>
<h4 id="Map-Phase-4">Map Phase</h4>
<ol>
<li>
<p>Input: Each order record<br>
-&gt; Calculate revenue: <code>revenue = quantity * price</code>.<br>
-&gt; Emit <code>(company_id + date, revenue)</code>.</p>
</li>
<li>
<p>Mapper Output:</p>
 <pre class="language-none"><code class="language-none">(&quot;1_2023-10-01&quot;, 599.98)  &#x2F;&#x2F; 2 * 299.99  
(&quot;2_2023-10-01&quot;, 99.99)   &#x2F;&#x2F; 1 * 99.99  
(&quot;1_2023-10-02&quot;, 899.97)  &#x2F;&#x2F; 3 * 299.99  
(&quot;3_2023-10-02&quot;, 149.99)  &#x2F;&#x2F; 1 * 149.99  
(&quot;2_2023-10-03&quot;, 199.98)  &#x2F;&#x2F; 2 * 99.99  </code></pre>
</li>
</ol>
<h4 id="Shuffle-Sort-Phase-4">Shuffle &amp; Sort Phase</h4>
<ol>
<li>Groups revenues by <code>(company_id + date)</code>: <pre class="language-none"><code class="language-none">&quot;1_2023-10-01&quot; → [599.98]  
&quot;2_2023-10-01&quot; → [99.99]  
&quot;1_2023-10-02&quot; → [899.97]  
&quot;3_2023-10-02&quot; → [149.99]  
&quot;2_2023-10-03&quot; → [199.98]  </code></pre>
</li>
</ol>
<h4 id="Reduce-Phase-First-Pass-Daily-Revenue">Reduce Phase (First Pass - Daily Revenue)</h4>
<ol>
<li>Input: <code>(company_date, [revenues])</code> -&gt; Sum daily revenue for each company.</li>
<li>Reducer Output (Daily Revenue): <pre class="language-none"><code class="language-none">(&quot;1_2023-10-01&quot;, 599.98)  
(&quot;2_2023-10-01&quot;, 99.99)  
(&quot;1_2023-10-02&quot;, 899.97)  
(&quot;3_2023-10-02&quot;, 149.99)  
(&quot;2_2023-10-03&quot;, 199.98)  </code></pre>
</li>
</ol>
<h4 id="Second-MapReduce-Average-Calculation"><strong>Second MapReduce (Average Calculation)</strong></h4>
<h4 id="Map-Phase-2">Map Phase 2:</h4>
<ol>
<li>Reorganize data by <code>company_id</code>: <pre class="language-none"><code class="language-none">(1, (2023-10-01, 599.98))  
(2, (2023-10-01, 99.99))  
(1, (2023-10-02, 899.97))  
(3, (2023-10-02, 149.99))  
(2, (2023-10-03, 199.98))  </code></pre>
</li>
</ol>
<h4 id="Reduce-Phase-2">Reduce Phase 2:</h4>
<ol>
<li>Input: <code>(company_id, [(date, revenue), ...])</code><br>
-&gt; Sum all revenues for the company.<br>
-&gt; Count the number of days.<br>
-&gt; Compute average: <code>avg_revenue = total_revenue / days</code>.</li>
<li>Final Reducer Output: <pre class="language-none"><code class="language-none">Company 1: Avg daily revenue &#x3D; (599.98 + 899.97) &#x2F; 2 &#x3D; 749.975  
Company 2: Avg daily revenue &#x3D; (99.99 + 199.98) &#x2F; 2 &#x3D; 149.985  
Company 3: Avg daily revenue &#x3D; 149.99 &#x2F; 1 &#x3D; 149.99  </code></pre>
</li>
</ol>
<h4 id="Final-Result-4">Final Result</h4>
<pre class="language-none"><code class="language-none">Company 1: $749.98 per day  
Company 2: $149.99 per day  
Company 3: $149.99 per day  </code></pre>

</div>

<!-- post-guide -->

    <div class="post-guide">
        <div class="item left">
            
              <a href="/other/settingUp-shell/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  settingUp_shell
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/data_str_and_algo/intro-to-algo/">
                intro_to_algo
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>


<!-- comment - giscus -->


<!-- comment - valine -->


<script>
	
	
</script>

	</div>
	<div id="footer">
	<p>
	©<span id="footerYear-start"></span>-<span id="footerYear-end"></span>

	
	    <a href="/">HuiWen</a>
	
	
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//wujun.me" target="_blank">Wu Jun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>


<script type="text/javascript">
	document.getElementById('footerYear-start').innerHTML = new Date().getFullYear() + '';
</script>

<script type="text/javascript">
	document.getElementById('footerYear-end').innerHTML = new Date().getFullYear() + '';
</script>

    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
    <script>
      if (window.mermaid) {
        mermaid.initialize({theme: 'forest'});
      }
    </script>




	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>